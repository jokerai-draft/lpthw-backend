
Time Interval Problem 时间间隔问题

关注的问题: 如何获取一个生成的随机数, 每十分钟一次?
 (参考v2ex.com/t/797408)

理解问题
- 随机数来源, 任何一个一次性执行脚本 语言不限 // 常驻脚本不存在
- 谁去获得? 服务器控制的无限访问在刷新这个数字, 每十分钟刷新出来一个新数字

作答1
cron 定时启动执行文件 - 写入一个文件 - 让其它刷新者去只读读取这个文件 故而可以做到每十分钟刷新出来一个新数字
                        ^ file_put_contents('storage', serialize(self::$state));

作答1细节

让 cron 执行一个 bash 脚本, bash 脚本调用一个 php 脚本去写入一个文件, 供其它刷新者读取
让其它刷新者去只读读取这个文件 (或者让其它刷新者去读取一个 fileReader 的实例 which is 专门负责只读这个文件)

作答2

找个有随机数种子的随机数生成器，然后每十分钟换个新种子
十分钟时间点是可用取余数法得到

其实可以 cron 定时启动执行文件来解决 或 laravel 队列

无法解决的问题
（在状态管理之后）php 本身非常驻文件的问题, 常驻内存的脚本数量是零 —————————— 它是一个没有解决的问题 脚本无法长驻内存所带来的问题
// 也就是说 只有固化层来的数字是可靠的: 可以保证读取的

作答3

要求每十分钟换数字 // 十分钟 600秒
按照当前时间 (时间格式 timestamp 即 Unix 时间戳), 对 600 取商(余数是距离下一个整点的 time interval)
echo floor(time() / 600); # 600s之内不会变
echo floor(time() / 10);  # 10s之内不会变
-如果有需要计算和某时刻的间隔, 减去某时刻的 timestamp 即可 详见 php get timestamp from date time
-如果通过它来生成随机数, 那么就把它当作随机数种子去生成随机数即可
